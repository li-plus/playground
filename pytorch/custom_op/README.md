# PyTorch Custom Op

Reference: [[tutorial](https://pytorch.org/tutorials/advanced/cpp_extension.html)] [[code](https://github.com/pytorch/extension-cpp)]

Use [Bear](https://github.com/rizsotto/Bear) to generate compilation database (`compile_commands.json`).

RMSNorm benchmark:
```
torch.float64 forward:
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
| shape                        |   rms_norm_naive |   rms_norm_ts |   rms_norm_triton |   rms_norm_cuda |   speedup vs triton |
|------------------------------+------------------+---------------+-------------------+-----------------+---------------------|
| torch.Size([4, 128, 32])     |           87.259 |        77.307 |           110.363 |          16.086 |               6.861 |
| torch.Size([4, 128, 61])     |           87.174 |        73.576 |           125.442 |          16.244 |               7.722 |
| torch.Size([4, 128, 64])     |           86.938 |        93.556 |           122.336 |          17.399 |               7.031 |
| torch.Size([4, 128, 128])    |           84.759 |        90.044 |           122.805 |          15.821 |               7.762 |
| torch.Size([4, 128, 130])    |           85.038 |        90.723 |           120.493 |          16.301 |               7.392 |
| torch.Size([4, 128, 256])    |           84.516 |        91.493 |           118.233 |          17.014 |               6.949 |
| torch.Size([4, 128, 512])    |           85.734 |        92.098 |           118.922 |          17.329 |               6.863 |
| torch.Size([4, 128, 1024])   |           85.144 |        94.202 |           118.788 |          16.312 |               7.282 |
| torch.Size([4, 128, 1027])   |           87.106 |        92.871 |           120.343 |          16.664 |               7.222 |
| torch.Size([4, 128, 2048])   |           84.480 |        92.775 |           119.786 |          17.505 |               6.843 |
| torch.Size([4, 128, 4096])   |           92.737 |        98.872 |           122.415 |          24.959 |               4.905 |
| torch.Size([4, 128, 8192])   |          179.609 |       191.037 |           270.724 |          48.712 |               5.558 |
| torch.Size([4, 128, 16384])  |          344.923 |       373.866 |           533.301 |         115.854 |               4.603 |
| torch.Size([4, 512, 32])     |           86.440 |        97.573 |           124.364 |          15.543 |               8.001 |
| torch.Size([4, 512, 61])     |          100.071 |        95.771 |           132.377 |          16.013 |               8.267 |
| torch.Size([4, 512, 64])     |           86.269 |        93.766 |           125.049 |          20.892 |               5.986 |
| torch.Size([4, 512, 128])    |           87.560 |        92.003 |           129.276 |          16.694 |               7.744 |
| torch.Size([4, 512, 130])    |           89.569 |        93.681 |           125.226 |          15.802 |               7.925 |
| torch.Size([4, 512, 256])    |           90.100 |        91.020 |           123.190 |          16.977 |               7.256 |
| torch.Size([4, 512, 512])    |           87.526 |        92.892 |           122.652 |          17.316 |               7.083 |
| torch.Size([4, 512, 1024])   |           90.248 |        93.165 |           132.738 |          22.402 |               5.925 |
| torch.Size([4, 512, 1027])   |           88.609 |        95.876 |           125.699 |          24.064 |               5.223 |
| torch.Size([4, 512, 2048])   |          184.071 |       193.620 |           178.987 |          45.312 |               3.950 |
| torch.Size([4, 512, 4096])   |          347.718 |       375.474 |           345.623 |          85.131 |               4.060 |
| torch.Size([4, 512, 8192])   |          656.109 |       714.175 |           682.142 |         174.438 |               3.911 |
| torch.Size([4, 512, 16384])  |         1271.391 |      1384.387 |          1365.494 |         447.403 |               3.052 |
| torch.Size([4, 2048, 32])    |           90.408 |        92.741 |           125.456 |          16.483 |               7.611 |
| torch.Size([4, 2048, 61])    |           94.461 |        97.964 |           124.624 |          17.882 |               6.969 |
| torch.Size([4, 2048, 64])    |           88.088 |        92.077 |           125.220 |          16.113 |               7.772 |
| torch.Size([4, 2048, 128])   |           85.510 |        92.057 |           120.160 |          16.984 |               7.075 |
| torch.Size([4, 2048, 130])   |           86.541 |        92.190 |           121.808 |          15.889 |               7.666 |
| torch.Size([4, 2048, 256])   |           87.453 |        93.828 |           124.613 |          19.467 |               6.401 |
| torch.Size([4, 2048, 512])   |          180.044 |       189.791 |           124.796 |          43.845 |               2.846 |
| torch.Size([4, 2048, 1024])  |          346.017 |       374.605 |           150.427 |          83.013 |               1.812 |
| torch.Size([4, 2048, 1027])  |          349.518 |       377.718 |           174.391 |          85.477 |               2.040 |
| torch.Size([4, 2048, 2048])  |          659.206 |       718.041 |           306.446 |         160.295 |               1.912 |
| torch.Size([4, 2048, 4096])  |         1281.356 |      1399.370 |           592.040 |         317.162 |               1.867 |
| torch.Size([4, 2048, 8192])  |         2494.859 |      2728.030 |          1174.671 |         691.018 |               1.700 |
| torch.Size([4, 2048, 16384]) |         4939.740 |      5416.828 |          2379.254 |        1760.726 |               1.351 |
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
torch.float64 backward:
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
| shape                        |   rms_norm_naive |   rms_norm_ts |   rms_norm_triton |   rms_norm_cuda |   speedup vs triton |
|------------------------------+------------------+---------------+-------------------+-----------------+---------------------|
| torch.Size([4, 128, 32])     |          214.178 |       212.925 |           171.910 |          69.919 |               2.459 |
| torch.Size([4, 128, 61])     |          216.151 |       151.256 |           176.057 |          80.237 |               2.194 |
| torch.Size([4, 128, 64])     |          225.674 |       151.271 |           194.408 |          76.205 |               2.551 |
| torch.Size([4, 128, 128])    |          213.277 |       171.003 |           174.755 |          76.891 |               2.273 |
| torch.Size([4, 128, 130])    |          212.768 |       175.687 |           179.789 |          73.397 |               2.450 |
| torch.Size([4, 128, 256])    |          267.247 |       195.335 |           194.824 |          73.464 |               2.652 |
| torch.Size([4, 128, 512])    |          209.038 |       169.745 |           187.994 |          74.758 |               2.515 |
| torch.Size([4, 128, 1024])   |          214.279 |       169.144 |           169.220 |          70.645 |               2.395 |
| torch.Size([4, 128, 1027])   |          212.450 |       168.224 |           169.989 |          73.374 |               2.317 |
| torch.Size([4, 128, 2048])   |          209.682 |       169.059 |           171.774 |          81.097 |               2.118 |
| torch.Size([4, 128, 4096])   |          261.455 |       202.535 |           245.419 |         113.419 |               2.164 |
| torch.Size([4, 128, 8192])   |          482.167 |       375.820 |           489.631 |         197.780 |               2.476 |
| torch.Size([4, 128, 16384])  |          915.413 |       697.391 |           958.029 |         428.179 |               2.237 |
| torch.Size([4, 512, 32])     |          225.376 |       174.612 |           195.807 |         101.892 |               1.922 |
| torch.Size([4, 512, 61])     |          212.544 |       197.931 |           198.176 |          72.908 |               2.718 |
| torch.Size([4, 512, 64])     |          228.879 |       178.383 |           181.199 |          78.390 |               2.312 |
| torch.Size([4, 512, 128])    |          224.248 |       189.681 |           186.033 |          77.030 |               2.415 |
| torch.Size([4, 512, 130])    |          218.135 |       180.547 |           176.595 |          78.425 |               2.252 |
| torch.Size([4, 512, 256])    |          214.473 |       179.004 |           182.836 |          81.751 |               2.236 |
| torch.Size([4, 512, 512])    |          217.962 |       179.031 |           176.632 |          77.620 |               2.276 |
| torch.Size([4, 512, 1024])   |          246.186 |       190.626 |           191.266 |         106.306 |               1.799 |
| torch.Size([4, 512, 1027])   |          250.717 |       198.507 |           203.436 |         110.966 |               1.833 |
| torch.Size([4, 512, 2048])   |          485.274 |       379.834 |           374.389 |         190.391 |               1.966 |
| torch.Size([4, 512, 4096])   |          924.426 |       701.283 |           722.362 |         349.771 |               2.065 |
| torch.Size([4, 512, 8192])   |         1727.165 |      1325.798 |          1428.963 |         691.674 |               2.066 |
| torch.Size([4, 512, 16384])  |         3319.140 |      2557.123 |          2825.444 |        1616.169 |               1.748 |
| torch.Size([4, 2048, 32])    |          215.911 |       189.279 |           209.240 |          88.064 |               2.376 |
| torch.Size([4, 2048, 61])    |          239.749 |       193.156 |           191.820 |          87.455 |               2.193 |
| torch.Size([4, 2048, 64])    |          218.289 |       185.005 |           173.610 |          76.199 |               2.278 |
| torch.Size([4, 2048, 128])   |          214.819 |       184.181 |           171.323 |          76.105 |               2.251 |
| torch.Size([4, 2048, 130])   |          228.643 |       182.627 |           173.128 |          75.346 |               2.298 |
| torch.Size([4, 2048, 256])   |          249.348 |       196.813 |           186.590 |         111.426 |               1.675 |
| torch.Size([4, 2048, 512])   |          489.580 |       381.796 |           252.612 |         197.488 |               1.279 |
| torch.Size([4, 2048, 1024])  |          927.385 |       709.479 |           420.382 |         362.709 |               1.159 |
| torch.Size([4, 2048, 1027])  |          926.473 |       706.619 |           447.334 |         345.631 |               1.294 |
| torch.Size([4, 2048, 2048])  |         1737.424 |      1337.402 |           768.487 |         674.760 |               1.139 |
| torch.Size([4, 2048, 4096])  |         3347.851 |      2575.311 |          1493.497 |        1287.787 |               1.160 |
| torch.Size([4, 2048, 8192])  |         6542.289 |      5033.871 |          2943.150 |        2708.079 |               1.087 |
| torch.Size([4, 2048, 16384]) |        12949.211 |     10005.497 |          5846.868 |        6340.895 |               0.922 |
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
torch.float32 forward:
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
| shape                        |   rms_norm_naive |   rms_norm_ts |   rms_norm_triton |   rms_norm_cuda |   speedup vs triton |
|------------------------------+------------------+---------------+-------------------+-----------------+---------------------|
| torch.Size([4, 128, 32])     |           64.205 |        51.716 |           117.249 |          15.805 |               7.418 |
| torch.Size([4, 128, 61])     |           62.702 |        54.154 |           117.654 |          15.634 |               7.525 |
| torch.Size([4, 128, 64])     |           63.731 |        70.304 |           117.123 |          16.375 |               7.153 |
| torch.Size([4, 128, 128])    |           63.472 |        70.410 |           119.252 |          17.042 |               6.998 |
| torch.Size([4, 128, 130])    |           66.167 |        69.087 |           118.330 |          17.100 |               6.920 |
| torch.Size([4, 128, 256])    |           65.331 |        70.945 |           119.651 |          16.638 |               7.191 |
| torch.Size([4, 128, 512])    |           65.647 |        71.186 |           116.305 |          17.290 |               6.727 |
| torch.Size([4, 128, 1024])   |           69.994 |        72.515 |           121.370 |          17.180 |               7.065 |
| torch.Size([4, 128, 1027])   |           64.776 |        70.393 |           248.795 |          15.679 |              15.869 |
| torch.Size([4, 128, 2048])   |           64.835 |        72.275 |           116.788 |          15.537 |               7.517 |
| torch.Size([4, 128, 4096])   |           64.026 |        70.807 |           125.112 |          15.708 |               7.965 |
| torch.Size([4, 128, 8192])   |           86.625 |        97.197 |           365.941 |          22.350 |              16.373 |
| torch.Size([4, 128, 16384])  |          167.788 |       195.827 |          1050.136 |          49.140 |              21.370 |
| torch.Size([4, 512, 32])     |           63.878 |        69.382 |           117.789 |          15.613 |               7.544 |
| torch.Size([4, 512, 61])     |           65.280 |        75.241 |           125.300 |          16.833 |               7.444 |
| torch.Size([4, 512, 64])     |           63.736 |        72.619 |           117.141 |          16.941 |               6.915 |
| torch.Size([4, 512, 128])    |           63.210 |        75.755 |           120.514 |          16.595 |               7.262 |
| torch.Size([4, 512, 130])    |           65.300 |        70.895 |           120.260 |          16.733 |               7.187 |
| torch.Size([4, 512, 256])    |           64.851 |        71.655 |           121.328 |          15.657 |               7.749 |
| torch.Size([4, 512, 512])    |           66.420 |        70.228 |           118.969 |          17.310 |               6.873 |
| torch.Size([4, 512, 1024])   |           64.386 |        71.395 |           120.837 |          17.334 |               6.971 |
| torch.Size([4, 512, 1027])   |           65.219 |        71.297 |           116.735 |          17.387 |               6.714 |
| torch.Size([4, 512, 2048])   |           89.957 |       100.433 |           123.162 |          23.469 |               5.248 |
| torch.Size([4, 512, 4096])   |          168.083 |       195.308 |           294.778 |          46.139 |               6.389 |
| torch.Size([4, 512, 8192])   |          314.402 |       374.844 |           572.386 |          85.454 |               6.698 |
| torch.Size([4, 512, 16384])  |          594.817 |       714.507 |          1127.958 |         178.775 |               6.309 |
| torch.Size([4, 2048, 32])    |           63.594 |        71.152 |           118.903 |          16.596 |               7.165 |
| torch.Size([4, 2048, 61])    |           64.959 |        70.845 |           119.706 |          16.421 |               7.290 |
| torch.Size([4, 2048, 64])    |           66.049 |        69.585 |           119.948 |          16.961 |               7.072 |
| torch.Size([4, 2048, 128])   |           63.620 |        72.205 |           122.310 |          15.459 |               7.912 |
| torch.Size([4, 2048, 130])   |           64.647 |        72.166 |           118.956 |          16.424 |               7.243 |
| torch.Size([4, 2048, 256])   |           63.179 |        70.269 |           117.858 |          16.640 |               7.083 |
| torch.Size([4, 2048, 512])   |           86.200 |        96.565 |           124.930 |          22.625 |               5.522 |
| torch.Size([4, 2048, 1024])  |          168.432 |       195.866 |           123.438 |          44.594 |               2.768 |
| torch.Size([4, 2048, 1027])  |          170.817 |       198.488 |           124.413 |          50.058 |               2.485 |
| torch.Size([4, 2048, 2048])  |          316.719 |       378.266 |           192.757 |          83.523 |               2.308 |
| torch.Size([4, 2048, 4096])  |          605.833 |       727.856 |           383.153 |         163.111 |               2.349 |
| torch.Size([4, 2048, 8192])  |         1160.696 |      1396.627 |           748.105 |         315.669 |               2.370 |
| torch.Size([4, 2048, 16384]) |         2290.764 |      2761.495 |          1487.202 |         690.579 |               2.154 |
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
torch.float32 backward:
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
| shape                        |   rms_norm_naive |   rms_norm_ts |   rms_norm_triton |   rms_norm_cuda |   speedup vs triton |
|------------------------------+------------------+---------------+-------------------+-----------------+---------------------|
| torch.Size([4, 128, 32])     |          182.715 |       138.465 |           173.419 |          70.338 |               2.466 |
| torch.Size([4, 128, 61])     |          182.929 |       123.158 |           171.194 |          69.381 |               2.467 |
| torch.Size([4, 128, 64])     |          184.201 |       120.751 |           174.461 |          74.951 |               2.328 |
| torch.Size([4, 128, 128])    |          182.138 |       135.367 |           172.467 |          74.410 |               2.318 |
| torch.Size([4, 128, 130])    |          183.162 |       145.298 |           174.044 |          74.262 |               2.344 |
| torch.Size([4, 128, 256])    |          186.486 |       141.588 |           176.437 |          75.870 |               2.326 |
| torch.Size([4, 128, 512])    |          178.443 |       143.948 |           183.709 |          81.909 |               2.243 |
| torch.Size([4, 128, 1024])   |          179.313 |       134.701 |           168.930 |          72.313 |               2.336 |
| torch.Size([4, 128, 1027])   |          192.235 |       139.836 |           171.235 |          69.701 |               2.457 |
| torch.Size([4, 128, 2048])   |          183.971 |       137.592 |           168.914 |          70.475 |               2.397 |
| torch.Size([4, 128, 4096])   |          180.666 |       139.005 |           210.824 |          70.517 |               2.990 |
| torch.Size([4, 128, 8192])   |          337.383 |       204.171 |           687.831 |         106.446 |               6.462 |
| torch.Size([4, 128, 16384])  |          596.881 |       378.162 |          1394.987 |         192.059 |               7.263 |
| torch.Size([4, 512, 32])     |          181.102 |       139.311 |           170.212 |          74.161 |               2.295 |
| torch.Size([4, 512, 61])     |          183.605 |       139.279 |           174.763 |          77.528 |               2.254 |
| torch.Size([4, 512, 64])     |          194.184 |       156.644 |           175.717 |          73.936 |               2.377 |
| torch.Size([4, 512, 128])    |          182.845 |       143.136 |           168.591 |          78.514 |               2.147 |
| torch.Size([4, 512, 130])    |          184.412 |       153.162 |           181.835 |          77.066 |               2.359 |
| torch.Size([4, 512, 256])    |          186.267 |       143.582 |           175.944 |          76.438 |               2.302 |
| torch.Size([4, 512, 512])    |          185.762 |       142.265 |           170.390 |          74.977 |               2.273 |
| torch.Size([4, 512, 1024])   |          186.293 |       143.960 |           172.903 |          76.883 |               2.249 |
| torch.Size([4, 512, 1027])   |          182.785 |       136.649 |           173.899 |          70.859 |               2.454 |
| torch.Size([4, 512, 2048])   |          307.545 |       203.271 |           272.979 |          99.870 |               2.733 |
| torch.Size([4, 512, 4096])   |          601.604 |       378.085 |           495.439 |         185.333 |               2.673 |
| torch.Size([4, 512, 8192])   |         1110.668 |       708.305 |           923.520 |         338.506 |               2.728 |
| torch.Size([4, 512, 16384])  |         2113.453 |      1352.092 |          1807.110 |         680.499 |               2.656 |
| torch.Size([4, 2048, 32])    |          185.098 |       151.108 |           173.258 |          78.322 |               2.212 |
| torch.Size([4, 2048, 61])    |          184.648 |       150.453 |           173.840 |          76.525 |               2.272 |
| torch.Size([4, 2048, 64])    |          192.493 |       154.323 |           173.378 |          78.427 |               2.211 |
| torch.Size([4, 2048, 128])   |          184.368 |       151.774 |           178.959 |          78.914 |               2.268 |
| torch.Size([4, 2048, 130])   |          186.912 |       152.894 |           181.779 |          74.274 |               2.447 |
| torch.Size([4, 2048, 256])   |          185.238 |       154.040 |           269.907 |          74.889 |               3.604 |
| torch.Size([4, 2048, 512])   |          312.589 |       206.756 |           337.806 |         105.617 |               3.198 |
| torch.Size([4, 2048, 1024])  |          606.817 |       385.213 |           437.542 |         184.017 |               2.378 |
| torch.Size([4, 2048, 1027])  |          609.264 |       386.596 |           503.145 |         190.137 |               2.646 |
| torch.Size([4, 2048, 2048])  |         1119.277 |       716.413 |           617.329 |         343.339 |               1.798 |
| torch.Size([4, 2048, 4096])  |         2135.760 |      1367.909 |          1038.715 |         659.058 |               1.576 |
| torch.Size([4, 2048, 8192])  |         4141.322 |      2640.403 |          1852.810 |        1246.271 |               1.487 |
| torch.Size([4, 2048, 16384]) |         8178.614 |      5226.756 |          3625.603 |        2631.837 |               1.378 |
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
torch.float16 forward:
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
| shape                        |   rms_norm_naive |   rms_norm_ts |   rms_norm_triton |   rms_norm_cuda |   speedup vs triton |
|------------------------------+------------------+---------------+-------------------+-----------------+---------------------|
| torch.Size([4, 128, 32])     |           85.607 |        69.617 |           117.236 |          16.934 |               6.923 |
| torch.Size([4, 128, 61])     |           87.447 |        75.144 |           120.895 |          16.834 |               7.182 |
| torch.Size([4, 128, 64])     |           86.540 |        92.064 |           118.708 |          16.257 |               7.302 |
| torch.Size([4, 128, 128])    |           83.972 |        94.686 |           119.306 |          16.792 |               7.105 |
| torch.Size([4, 128, 130])    |           91.376 |        95.737 |           119.340 |          16.419 |               7.268 |
| torch.Size([4, 128, 256])    |           87.582 |        92.492 |           120.756 |          17.271 |               6.992 |
| torch.Size([4, 128, 512])    |           88.010 |        91.990 |           116.981 |          15.329 |               7.631 |
| torch.Size([4, 128, 1024])   |           86.132 |        92.523 |           118.663 |          16.622 |               7.139 |
| torch.Size([4, 128, 1027])   |           90.365 |        93.343 |           118.695 |          17.099 |               6.942 |
| torch.Size([4, 128, 2048])   |           87.239 |        94.880 |           121.283 |          17.167 |               7.065 |
| torch.Size([4, 128, 4096])   |           87.779 |        92.790 |           120.613 |          17.214 |               7.007 |
| torch.Size([4, 128, 8192])   |          120.580 |       130.866 |           227.404 |          15.536 |              14.638 |
| torch.Size([4, 128, 16384])  |          253.567 |       279.709 |           620.788 |          23.136 |              26.832 |
| torch.Size([4, 512, 32])     |           89.603 |        92.289 |           117.527 |          16.780 |               7.004 |
| torch.Size([4, 512, 61])     |           90.976 |        95.486 |           120.461 |          15.539 |               7.752 |
| torch.Size([4, 512, 64])     |           85.959 |        91.541 |           118.073 |          16.212 |               7.283 |
| torch.Size([4, 512, 128])    |           86.983 |        91.124 |           118.162 |          15.982 |               7.393 |
| torch.Size([4, 512, 130])    |           86.552 |        95.030 |           118.663 |          16.757 |               7.081 |
| torch.Size([4, 512, 256])    |           87.817 |        94.636 |           118.511 |          16.248 |               7.294 |
| torch.Size([4, 512, 512])    |           86.123 |        94.997 |           124.519 |          18.091 |               6.883 |
| torch.Size([4, 512, 1024])   |           88.180 |        93.515 |           118.500 |          16.516 |               7.175 |
| torch.Size([4, 512, 1027])   |           87.650 |        92.266 |           118.138 |          16.851 |               7.011 |
| torch.Size([4, 512, 2048])   |          123.617 |       134.470 |           120.246 |          16.612 |               7.239 |
| torch.Size([4, 512, 4096])   |          253.724 |       349.524 |           256.394 |          30.880 |               8.303 |
| torch.Size([4, 512, 8192])   |          474.408 |       534.602 |           627.540 |          46.873 |              13.388 |
| torch.Size([4, 512, 16384])  |          900.092 |      1020.867 |          1238.427 |          85.730 |              14.446 |
| torch.Size([4, 2048, 32])    |           91.892 |        91.348 |           124.732 |          15.439 |               8.079 |
| torch.Size([4, 2048, 61])    |           88.025 |        93.829 |           116.629 |          16.380 |               7.120 |
| torch.Size([4, 2048, 64])    |           86.893 |        92.986 |           120.414 |          16.282 |               7.395 |
| torch.Size([4, 2048, 128])   |           89.594 |        93.803 |           120.738 |          17.384 |               6.945 |
| torch.Size([4, 2048, 130])   |           86.020 |        91.401 |           117.795 |          16.646 |               7.076 |
| torch.Size([4, 2048, 256])   |           88.195 |        92.134 |           118.130 |          15.375 |               7.683 |
| torch.Size([4, 2048, 512])   |          120.870 |       129.730 |           117.501 |          16.273 |               7.221 |
| torch.Size([4, 2048, 1024])  |          254.302 |       280.295 |           121.450 |          26.357 |               4.608 |
| torch.Size([4, 2048, 1027])  |          257.236 |       283.630 |           121.426 |         145.362 |               0.835 |
| torch.Size([4, 2048, 2048])  |          477.426 |       536.561 |           201.587 |          51.046 |               3.949 |
| torch.Size([4, 2048, 4096])  |          910.092 |      1035.401 |           383.308 |         106.881 |               3.586 |
| torch.Size([4, 2048, 8192])  |         1751.875 |      1993.745 |           751.947 |         162.236 |               4.635 |
| torch.Size([4, 2048, 16384]) |         3450.129 |      3946.831 |          1479.296 |         312.063 |               4.740 |
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
torch.float16 backward:
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
| shape                        |   rms_norm_naive |   rms_norm_ts |   rms_norm_triton |   rms_norm_cuda |   speedup vs triton |
|------------------------------+------------------+---------------+-------------------+-----------------+---------------------|
| torch.Size([4, 128, 32])     |          208.626 |       166.157 |           167.390 |          68.838 |               2.432 |
| torch.Size([4, 128, 61])     |          217.812 |       148.072 |           184.167 |          72.808 |               2.529 |
| torch.Size([4, 128, 64])     |          216.158 |       152.045 |           173.731 |          73.939 |               2.350 |
| torch.Size([4, 128, 128])    |          213.874 |       164.116 |           172.050 |          71.309 |               2.413 |
| torch.Size([4, 128, 130])    |          214.446 |       173.447 |           180.108 |          75.543 |               2.384 |
| torch.Size([4, 128, 256])    |          212.778 |       169.893 |           172.935 |          71.568 |               2.416 |
| torch.Size([4, 128, 512])    |          215.237 |       169.080 |           182.946 |          71.664 |               2.553 |
| torch.Size([4, 128, 1024])   |          216.170 |       171.497 |           173.845 |          70.080 |               2.481 |
| torch.Size([4, 128, 1027])   |          217.492 |       169.836 |           176.670 |          73.448 |               2.405 |
| torch.Size([4, 128, 2048])   |          214.382 |       175.391 |           175.708 |          72.485 |               2.424 |
| torch.Size([4, 128, 4096])   |          210.332 |       172.118 |           202.017 |          71.343 |               2.832 |
| torch.Size([4, 128, 8192])   |          310.034 |       201.238 |           445.224 |          72.325 |               6.156 |
| torch.Size([4, 128, 16384])  |          622.305 |       402.898 |          1792.623 |         114.180 |              15.700 |
| torch.Size([4, 512, 32])     |          212.067 |       175.747 |           169.324 |          72.914 |               2.322 |
| torch.Size([4, 512, 61])     |          209.918 |       170.027 |           167.797 |          71.338 |               2.352 |
| torch.Size([4, 512, 64])     |          217.906 |       175.311 |           174.187 |          75.043 |               2.321 |
| torch.Size([4, 512, 128])    |          216.602 |       176.853 |           173.872 |          75.029 |               2.317 |
| torch.Size([4, 512, 130])    |          216.300 |       179.980 |           171.400 |          74.516 |               2.300 |
| torch.Size([4, 512, 256])    |          220.088 |       181.153 |           175.289 |          75.885 |               2.310 |
| torch.Size([4, 512, 512])    |          217.276 |       175.389 |           172.362 |          77.354 |               2.228 |
| torch.Size([4, 512, 1024])   |          219.913 |       180.980 |           176.235 |          75.808 |               2.325 |
| torch.Size([4, 512, 1027])   |          211.310 |       167.919 |           169.880 |          70.703 |               2.403 |
| torch.Size([4, 512, 2048])   |          310.047 |       204.027 |           217.956 |          75.357 |               2.892 |
| torch.Size([4, 512, 4096])   |          622.506 |       398.318 |           566.879 |         113.864 |               4.979 |
| torch.Size([4, 512, 8192])   |         1141.985 |       744.289 |          1090.726 |         202.260 |               5.393 |
| torch.Size([4, 512, 16384])  |         2166.620 |      1405.612 |          2129.812 |         358.085 |               5.948 |
| torch.Size([4, 2048, 32])    |          217.718 |       183.782 |           170.045 |          75.340 |               2.257 |
| torch.Size([4, 2048, 61])    |          216.218 |       186.031 |           170.287 |          74.801 |               2.277 |
| torch.Size([4, 2048, 64])    |          216.892 |       185.354 |           171.489 |          76.190 |               2.251 |
| torch.Size([4, 2048, 128])   |          220.045 |       187.544 |           175.399 |          74.892 |               2.342 |
| torch.Size([4, 2048, 130])   |          219.427 |       186.200 |           173.688 |          76.682 |               2.265 |
| torch.Size([4, 2048, 256])   |          217.343 |       186.575 |           175.497 |          76.973 |               2.280 |
| torch.Size([4, 2048, 512])   |          314.362 |       204.328 |           286.592 |          75.876 |               3.777 |
| torch.Size([4, 2048, 1024])  |          623.876 |       405.573 |           426.017 |         107.346 |               3.969 |
| torch.Size([4, 2048, 1027])  |          628.878 |       408.784 |           477.842 |         134.900 |               3.542 |
| torch.Size([4, 2048, 2048])  |         1151.700 |       752.773 |           603.068 |         191.755 |               3.145 |
| torch.Size([4, 2048, 4096])  |         2187.964 |      1421.360 |           990.955 |         391.068 |               2.534 |
| torch.Size([4, 2048, 8192])  |         4228.903 |      2732.009 |          1731.475 |         701.989 |               2.467 |
| torch.Size([4, 2048, 16384]) |         8328.255 |      5387.334 |          3259.241 |        1323.466 |               2.463 |
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
torch.bfloat16 forward:
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
| shape                        |   rms_norm_naive |   rms_norm_ts |   rms_norm_triton |   rms_norm_cuda |   speedup vs triton |
|------------------------------+------------------+---------------+-------------------+-----------------+---------------------|
| torch.Size([4, 128, 32])     |           86.243 |        70.958 |           121.439 |          17.033 |               7.130 |
| torch.Size([4, 128, 61])     |           86.720 |        73.967 |           115.306 |          15.601 |               7.391 |
| torch.Size([4, 128, 64])     |           88.971 |        94.537 |           119.550 |          17.264 |               6.925 |
| torch.Size([4, 128, 128])    |           86.587 |        94.743 |           116.518 |          15.511 |               7.512 |
| torch.Size([4, 128, 130])    |           86.996 |        93.587 |           117.591 |          16.553 |               7.104 |
| torch.Size([4, 128, 256])    |           84.608 |        93.692 |           115.344 |          15.399 |               7.490 |
| torch.Size([4, 128, 512])    |           88.258 |        93.098 |           121.271 |          15.615 |               7.766 |
| torch.Size([4, 128, 1024])   |           86.392 |        93.685 |           119.149 |          15.305 |               7.785 |
| torch.Size([4, 128, 1027])   |           87.544 |        92.687 |           117.759 |          17.060 |               6.902 |
| torch.Size([4, 128, 2048])   |           86.138 |        94.251 |           117.104 |          16.862 |               6.945 |
| torch.Size([4, 128, 4096])   |           90.550 |        91.963 |           120.498 |          16.725 |               7.204 |
| torch.Size([4, 128, 8192])   |          122.391 |       131.926 |           227.048 |          17.511 |              12.966 |
| torch.Size([4, 128, 16384])  |          254.644 |       281.084 |           673.972 |          23.474 |              28.712 |
| torch.Size([4, 512, 32])     |           86.736 |        92.117 |           115.146 |          15.696 |               7.336 |
| torch.Size([4, 512, 61])     |           88.719 |        92.179 |           117.100 |          17.006 |               6.886 |
| torch.Size([4, 512, 64])     |           85.873 |        91.387 |           120.908 |          17.045 |               7.093 |
| torch.Size([4, 512, 128])    |           84.728 |        90.936 |           117.462 |          15.332 |               7.661 |
| torch.Size([4, 512, 130])    |           85.900 |        94.370 |           116.354 |          15.777 |               7.375 |
| torch.Size([4, 512, 256])    |           89.594 |        92.947 |           116.014 |          16.466 |               7.046 |
| torch.Size([4, 512, 512])    |           86.620 |        91.688 |           116.939 |          16.905 |               6.917 |
| torch.Size([4, 512, 1024])   |           89.241 |        94.987 |           119.955 |          15.770 |               7.606 |
| torch.Size([4, 512, 1027])   |           87.176 |        92.149 |           115.492 |          18.475 |               6.251 |
| torch.Size([4, 512, 2048])   |          123.208 |       134.010 |           117.977 |          19.474 |               6.058 |
| torch.Size([4, 512, 4096])   |          254.268 |       282.710 |           245.471 |          29.522 |               8.315 |
| torch.Size([4, 512, 8192])   |          476.981 |       536.974 |           628.512 |          46.127 |              13.626 |
| torch.Size([4, 512, 16384])  |          903.836 |      1027.172 |          1234.606 |          87.639 |              14.087 |
| torch.Size([4, 2048, 32])    |           86.430 |        94.209 |           117.014 |          16.000 |               7.314 |
| torch.Size([4, 2048, 61])    |           86.514 |        93.385 |           123.728 |          16.753 |               7.385 |
| torch.Size([4, 2048, 64])    |           87.348 |        92.100 |           117.249 |          16.914 |               6.932 |
| torch.Size([4, 2048, 128])   |           86.340 |        92.403 |           118.134 |          15.477 |               7.633 |
| torch.Size([4, 2048, 130])   |           86.521 |        93.265 |           123.353 |          15.575 |               7.920 |
| torch.Size([4, 2048, 256])   |           85.859 |        92.498 |           119.488 |          17.016 |               7.022 |
| torch.Size([4, 2048, 512])   |          120.202 |       130.385 |           115.819 |          16.585 |               6.983 |
| torch.Size([4, 2048, 1024])  |          254.923 |       282.130 |           118.680 |          26.002 |               4.564 |
| torch.Size([4, 2048, 1027])  |          258.075 |       284.524 |           117.477 |          47.467 |               2.475 |
| torch.Size([4, 2048, 2048])  |          479.940 |       539.204 |           197.760 |          49.326 |               4.009 |
| torch.Size([4, 2048, 4096])  |          913.095 |      1040.296 |           378.168 |         100.803 |               3.752 |
| torch.Size([4, 2048, 8192])  |         1758.187 |      2001.802 |           752.708 |         163.038 |               4.617 |
| torch.Size([4, 2048, 16384]) |         3468.533 |      3964.021 |          1478.066 |         321.731 |               4.594 |
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
torch.bfloat16 backward:
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
| shape                        |   rms_norm_naive |   rms_norm_ts |   rms_norm_triton |   rms_norm_cuda |   speedup vs triton |
|------------------------------+------------------+---------------+-------------------+-----------------+---------------------|
| torch.Size([4, 128, 32])     |          210.119 |       169.569 |           166.119 |          70.367 |               2.361 |
| torch.Size([4, 128, 61])     |          216.845 |       145.554 |           170.785 |          71.718 |               2.381 |
| torch.Size([4, 128, 64])     |          212.191 |       150.241 |           172.725 |          77.794 |               2.220 |
| torch.Size([4, 128, 128])    |          210.436 |       171.108 |           169.376 |          72.688 |               2.330 |
| torch.Size([4, 128, 130])    |          211.668 |       169.553 |           171.362 |          77.536 |               2.210 |
| torch.Size([4, 128, 256])    |          210.114 |       171.304 |           173.293 |          70.984 |               2.441 |
| torch.Size([4, 128, 512])    |          217.838 |       169.706 |           169.292 |          73.543 |               2.302 |
| torch.Size([4, 128, 1024])   |          213.841 |       169.795 |           170.983 |          70.249 |               2.434 |
| torch.Size([4, 128, 1027])   |          213.487 |       168.876 |           173.180 |          72.054 |               2.403 |
| torch.Size([4, 128, 2048])   |          216.376 |       171.283 |           168.565 |          71.177 |               2.368 |
| torch.Size([4, 128, 4096])   |          210.820 |       173.563 |           211.291 |          70.319 |               3.005 |
| torch.Size([4, 128, 8192])   |          307.197 |       199.094 |           453.728 |          72.668 |               6.244 |
| torch.Size([4, 128, 16384])  |          622.276 |       404.967 |          1813.644 |         112.391 |              16.137 |
| torch.Size([4, 512, 32])     |          211.223 |       171.508 |           169.219 |          71.555 |               2.365 |
| torch.Size([4, 512, 61])     |          212.333 |       174.716 |           168.285 |          71.770 |               2.345 |
| torch.Size([4, 512, 64])     |          218.387 |       177.322 |           170.017 |          86.939 |               1.956 |
| torch.Size([4, 512, 128])    |          220.621 |       176.834 |           169.706 |          75.718 |               2.241 |
| torch.Size([4, 512, 130])    |          219.856 |       181.578 |           194.388 |          78.059 |               2.490 |
| torch.Size([4, 512, 256])    |          216.791 |       178.301 |           171.114 |          74.647 |               2.292 |
| torch.Size([4, 512, 512])    |          218.427 |       175.705 |           172.414 |          72.900 |               2.365 |
| torch.Size([4, 512, 1024])   |          217.542 |       178.014 |           175.907 |          82.552 |               2.131 |
| torch.Size([4, 512, 1027])   |          216.018 |       169.620 |           165.763 |          70.028 |               2.367 |
| torch.Size([4, 512, 2048])   |          310.185 |       204.656 |           216.047 |          75.655 |               2.856 |
| torch.Size([4, 512, 4096])   |          621.640 |       397.267 |           577.177 |         103.660 |               5.568 |
| torch.Size([4, 512, 8192])   |         1145.961 |       746.531 |          1107.109 |         203.574 |               5.438 |
| torch.Size([4, 512, 16384])  |         2168.990 |      1411.080 |          2160.393 |         355.392 |               6.079 |
| torch.Size([4, 2048, 32])    |          216.359 |       183.867 |           167.848 |          73.020 |               2.299 |
| torch.Size([4, 2048, 61])    |          215.922 |       182.426 |           169.349 |          72.833 |               2.325 |
| torch.Size([4, 2048, 64])    |          216.509 |       184.591 |           168.899 |          74.240 |               2.275 |
| torch.Size([4, 2048, 128])   |          218.327 |       184.461 |           171.789 |          75.573 |               2.273 |
| torch.Size([4, 2048, 130])   |          217.051 |       193.508 |           169.930 |          78.810 |               2.156 |
| torch.Size([4, 2048, 256])   |          216.857 |       184.421 |           177.929 |          77.898 |               2.284 |
| torch.Size([4, 2048, 512])   |          310.849 |       204.606 |           293.583 |          75.860 |               3.870 |
| torch.Size([4, 2048, 1024])  |          624.403 |       405.898 |           427.856 |         108.483 |               3.944 |
| torch.Size([4, 2048, 1027])  |          628.798 |       408.061 |           475.795 |         135.404 |               3.514 |
| torch.Size([4, 2048, 2048])  |         1155.089 |       754.308 |           607.163 |         191.222 |               3.175 |
| torch.Size([4, 2048, 4096])  |         2194.382 |      1426.997 |           991.001 |         349.920 |               2.832 |
| torch.Size([4, 2048, 8192])  |         4235.372 |      2740.702 |          1737.795 |         700.825 |               2.480 |
| torch.Size([4, 2048, 16384]) |         8346.414 |      5401.947 |          3272.963 |        1320.233 |               2.479 |
+------------------------------+------------------+---------------+-------------------+-----------------+---------------------+
```
